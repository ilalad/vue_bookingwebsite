<template>
  <div class="parallax-hero position-relative">
    <div class="parallax-hero--container" ref="parallaxContainer">
      <div class="layer layer-1 layer--parallax" :style="`background-image: url(${image1});`"></div>
      <div class="parallax-hero--logo d-flex justify-center align-center">
        <div>
          <!-- logo -->
          <v-img
            width="396"
            height="151"
            max-width="30vw"
            contain
            class="mx-auto"
            src="https://res.cloudinary.com/die9ji2vn/image/upload/v1578304830/Home%20Page/logo2_qoiy2d.png"
          ></v-img>
        </div>
      </div>
      <div class="d-none" :style="`background-image: url(http://placehold.it/500x500);`"></div>
      <div class="layer layer-2 layer--parallax" :style="`background-image: url(${image2});`"></div>
      <div class="layer layer-3 layer--parallax" :style="`background-image: url(${image3});`"></div>
      <div class="layer layer-4 layer--parallax" :style="`background-image: url(${image4});`"></div>
      <div class="layer layer-5 layer--parallax" :style="`background-image: url(${image5});`"></div>
    </div>
    <div class="layer layer-6 layer--static position-absolute" :style="`background-image: url(${image6});`"></div>
  </div>
</template>

<script lang="ts">
import Vue from 'vue'
import { getPassiveEventConfig } from '@/helpers'

const images = {
  image1: {
    xs: 'https://res.cloudinary.com/die9ji2vn/image/upload/v1578391904/Home%20Page/1_Mobile_nic1jq.png',
    lg: 'https://res.cloudinary.com/die9ji2vn/image/upload/v1578391761/Home%20Page/1_xblbcz.png'
  },
  image2: {
    xs: 'https://res.cloudinary.com/die9ji2vn/image/upload/v1578391905/Home%20Page/2_Mobile_fbnhkc.png',
    lg: 'https://res.cloudinary.com/die9ji2vn/image/upload/v1578304830/Home%20Page/2_sswfon.png'
  },
  image3: {
    xs: 'https://res.cloudinary.com/die9ji2vn/image/upload/v1578391906/Home%20Page/3_Mobile_e9mhyt.png',
    lg: 'https://res.cloudinary.com/die9ji2vn/image/upload/v1578391697/Home%20Page/3_s78ihj.png'
  },
  image4: {
    xs: 'https://res.cloudinary.com/die9ji2vn/image/upload/v1578391906/Home%20Page/4_Mobile_ftjfdh.png',
    lg: 'https://res.cloudinary.com/die9ji2vn/image/upload/v1578304829/Home%20Page/4_y2kccp.png'
  },
  image5: {
    xs: 'https://res.cloudinary.com/die9ji2vn/image/upload/v1578391906/Home%20Page/5_Mobile_ozxcqz.png',
    lg: 'https://res.cloudinary.com/die9ji2vn/image/upload/v1578304830/Home%20Page/5_hqueja.png'
  },
  image6: {
    xs: 'https://res.cloudinary.com/die9ji2vn/image/upload/v1578391906/Home%20Page/6_Mobile_nogvnf.png',
    lg: 'https://res.cloudinary.com/die9ji2vn/image/upload/v1578304829/Home%20Page/6-_Black_nt3cjt.png'
  }
}

export default Vue.extend({
  name: 'page-home-parrallax-hero',
  mounted() {
    this.parallax()
  },
  methods: {
    parallax() {
      // Parallax
      window.addEventListener(
        'scroll',
        () => {
          let parent = this.$refs.parallaxContainer as HTMLElement
          // FIXME: check existense of parent
          let children = parent.getElementsByClassName('layer--parallax') as HTMLCollectionOf<HTMLElement>
          for (let i = 0; i < children.length; i++) {
            const translateAmount = (window.pageYOffset * i) / children.length
            children[i].style.transform = `translateY(-${translateAmount}px)`
          }
        },
        getPassiveEventConfig()
      )
    },
    getImage(number, breakpointName) {
      const image = images['image' + number]
      return image[breakpointName] || image['lg']
    }
  },
  computed: {
    image1(): string {
      const breakpointName = (this as any).$vuetify.breakpoint.name
      return this.getImage(1, breakpointName)
    },
    image2(): string {
      const breakpointName = (this as any).$vuetify.breakpoint.name
      return this.getImage(2, breakpointName)
    },
    image3(): string {
      const breakpointName = (this as any).$vuetify.breakpoint.name
      return this.getImage(3, breakpointName)
    },
    image4(): string {
      const breakpointName = (this as any).$vuetify.breakpoint.name
      return this.getImage(4, breakpointName)
    },
    image5(): string {
      const breakpointName = (this as any).$vuetify.breakpoint.name
      return this.getImage(5, breakpointName)
    },
    image6(): string {
      const breakpointName = (this as any).$vuetify.breakpoint.name
      return this.getImage(6, breakpointName)
    }
  }
})
</script>

<style lang="scss" scoped>
@import '@/styles/utility.scss';

$component-height: 1600px;
$header-height: 56px;
.parallax-hero {
  margin-top: rem($header-height);

  --component-height-ratio: 1;
  @include media-breakpoint-down(xs) {
    --component-height-ratio: 2.65;
  }
}
.parallax-hero--container {
  height: calc(#{rem($component-height)} / var(--component-height-ratio));
  display: block;
}
.layer {
  background-repeat: no-repeat;
  background-position-y: top;
  background-position-x: center;
}
.layer--parallax {
  position: fixed;
  transform: translateY(0px);
  height: calc(#{rem($component-height)} / var(--component-height-ratio));
  width: 100%;
}
.parallax-hero--logo {
  position: fixed;
  top: rem(120px);
  top: calc(#{rem(120px)} / var(--component-height-ratio));
  width: 100%;
}
// sky
.layer-1 {
  top: rem($header-height);
}
// clouds
.layer-2 {
  top: rem($header-height);
}
// mountains
.layer-3 {
  top: rem($header-height + 120px);
  top: calc(#{rem($header-height + 120px)} / var(--component-height-ratio));
}
// far trees
.layer-4 {
  top: rem($header-height + 440px);
  top: calc(#{rem($header-height + 440px)} / var(--component-height-ratio));
}
// building + dark trees
.layer-5 {
  top: rem($header-height + 580px);
  top: calc(#{rem($header-height + 580px)} / var(--component-height-ratio));
}
// near trees
.layer-6 {
  height: rem(582px);
  height: calc(#{rem(582px)} / var(--component-height-ratio));
  background-position-y: bottom;
  bottom: 0;
  right: 0;
  left: 0;
}
</style>
